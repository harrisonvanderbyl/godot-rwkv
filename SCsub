#!/usr/bin/env python

import os
Import('env')
Import('env_modules')
cwd = os.getcwd()
env_rwkv = env_modules.Clone()
# get cwd
cenv = os.getcwd()


if(env["PLATFORM"] != "win32"):
    

    env_rwkv.add_source_files(env.modules_sources, "*.cpp")
    
    # add -march=native
    env_rwkv.Append(CCFLAGS=['-march=native'])
    
    # -fopenmp  -flto  -fopenmp -funroll-loops -D_GLIBCXX_PARALLEL
    
    env_rwkv.Append(CCFLAGS=['-fexceptions'])
   
    # add -O3
    env_rwkv.Append(CCFLAGS=['-O3'])
    
    # add fast math
    env_rwkv.Append(CCFLAGS=['-ffast-math'])
    
    
    
    # add ./rwkv.hpp/include to include path
    env_rwkv.Append(CPPPATH=["./rwkv.hpp/include"])

else:
    env_rwkv.Append(CCFLAGS=['/O2'])
    env_rwkv.Append(CCFLAGS=['/EHsc'])
    
    # add ./rwkv.hpp/include to include path
    env_rwkv.Append(CPPPATH=["./rwkv.hpp/include"])
    

    env_rwkv.add_source_files(env.modules_sources, "*.cpp")
